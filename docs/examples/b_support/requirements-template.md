# B型支援CRM 要件テンプレ（問い合わせ -> 成約）

このテンプレは、新規 B型支援CRM の要件定義を作るための雛形です。  
成約後の管理は既存 B型支援SaaS 側に引き渡す前提で記述します。

## 1. スコープ

- 対象: 問い合わせ受付、初回接触、見学/体験調整、商談、成約判定
- 非対象: 成約後の継続支援管理、請求管理、日次運用

## 2. パイプライン定義（例）

| ステータス | 説明 | 進行条件 | 差し戻し条件 |
|---|---|---|---|
| `new_inquiry` | 新規問い合わせ | 問い合わせ登録完了 | 重複判定で統合 |
| `contacted` | 初回接触済み | 電話/メール接触完了 | 連絡不能で `lost` |
| `visit_scheduled` | 見学日程調整済み | 日程確定 | 日程未確定に戻す |
| `trial_scheduled` | 体験日程調整済み | 体験日確定 | 見学段階に戻す |
| `negotiating` | 契約調整中 | 条件提示済み | 体験段階に戻す |
| `won` | 成約 | 成約確定・承認済み | 原則なし |
| `lost` | 失注 | 失注理由確定 | 再開時に `contacted` |

## 3. エンティティ定義（最小）

| エンティティ | 必須項目 | 備考 |
|---|---|---|
| `lead` | 名前、連絡先、流入元、現在ステータス | 問い合わせ主体 |
| `lead_activity` | 実施日時、担当者、種別、メモ | 接触履歴 |
| `appointment` | 種別（見学/体験）、予定日時、結果 | 日程管理 |
| `deal` | 成約日、担当者、成約金額/条件 | 成約情報 |

## 4. 受け入れ基準テンプレ（AC）

### AC-001 問い合わせ登録

- Given: 新規問い合わせ情報が入力される
- When: 保存を実行する
- Then: `lead` が `new_inquiry` で作成される

### AC-002 成約確定時の連携

- Given: `deal` が成約可能状態
- When: 成約確定を実行する
- Then: 既存SaaS連携イベントが1回だけ送信される（重複防止）

### AC-003 権限境界

- Given: 一般担当者が他担当者の管理操作を実行する
- When: 更新APIを呼ぶ
- Then: 権限エラーで拒否される

## 5. 非機能要件（最低限）

- 監査ログ: ステータス変更と成約確定は必ず記録
- 重複防止: 同一問い合わせの重複作成ルールを明示
- 再送耐性: 連携APIは idempotency を持つ
- セキュリティ: 個人情報を含むテーブルは RLS を適用

## 6. 未決事項（TBD 管理）

- 成約定義の最終条件（誰の承認が必要か）
- 失注理由の分類粒度
- 成約後に既存SaaSへ渡す項目の最終セット
