# リネーム変更のTDD順序プレイブック

## 概要

リネーム系変更では「テスト先行」を徹底し、仕様の正を常にテストで表現する。
コード先行での変更を避け、意図しないふるまい変更を検出しやすくする。

## 適用条件

- API フィールド名変更
- 型名や関数名の変更
- ルーティングパスやクエリ名の変更

## アンチパターン

- 先に実装だけ変更し、後からテストを合わせる
- 失敗理由を確認せずにテストをまとめて修正する
- 旧仕様と新仕様の境界条件を省略する

## 推奨パターン

1. 先にテストを新名称へ更新し Red を作る
2. 実装を追従させて Green に戻す
3. 命名以外の変更を混ぜずに完了させる
4. 旧名称の残存を機械的に検出する

## 最小実装例

```ts
// Step 1: テストを先に変更（Red）
expect(response.data.staffId).toBeDefined();

// Step 2: 実装を変更（Green）
return { data: { staffId: row.staff_id } };
```

## チェックリスト

- [ ] テスト先行で Red を確認した
- [ ] 旧名称がコードベースに残っていない
- [ ] 命名変更以外のロジック差分を混入させていない
- [ ] 回帰テストで既存仕様が維持されている

## 関連テンプレート / プレイブック

- [Bulk Rename Safety](./bulk-rename-safety.md)
- [API Test Template](../../templates/api-contract/api-test-template.md)
