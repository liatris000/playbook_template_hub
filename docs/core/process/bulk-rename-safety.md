# 一括リネーム安全運用プレイブック

## 概要

`replace all` による巻き添え変更を防ぐため、対象範囲の特定と検証手順を標準化する。
同名フィールドが複数ドメインに存在する前提で運用する。

## 適用条件

- フィールド名・関数名・パス名の一括変更
- 文字列置換で複数ファイルに波及する変更
- ドメイン横断で同名シンボルが存在する

## アンチパターン

- 全リポジトリに無条件で一括置換する
- 置換後の差分レビューを省略する
- 変更対象リストを定義せずに実行する

## 推奨パターン

1. `rg` で全出現箇所を先に列挙する
2. 対象外を除外した「変更許可ファイル一覧」を作る
3. 置換後に再度 `rg` して未更新と過剰更新を検知する
4. 型チェックと主要テストで意味的な破壊を検出する

## 最小実装例

```bash
# 1) 出現箇所の棚卸し
rg -n "legacy_name" src tests

# 2) 置換対象の限定実行（例）
rg -l "legacy_name" src/domain/orders src/app/api | xargs sed -i '' 's/legacy_name/new_name/g'

# 3) 置換後検証
rg -n "legacy_name|new_name" src tests
npm run test
```

## チェックリスト

- [ ] 置換前に全出現箇所を保存した
- [ ] 対象ファイルを明示的に限定した
- [ ] 置換後に過剰更新がないことを確認した
- [ ] 主要シナリオの回帰テストを実行した

## 関連テンプレート / プレイブック

- [TDD Rename Sequence](./tdd-rename-sequence.md)
- [Failure Patterns](./failure-patterns.md)
